import{useContext as e,useRef as o,useState as t,useEffect as n}from"react";import{COOKIE_STORAGE as r}from"../../helpers/cookieStorage/cookieStorage.js";import{LOCAL_STORAGE as a}from"../../helpers/localStorage/localStorage.js";import{SESSION_STORAGE as c}from"../../helpers/sessionStorage/sessionStorage.js";import i from"@babel/runtime/helpers/slicedToArray";import{StorageConfig as s}from"./Storage.context.js";var l={localStorage:a,sessionStorage:c,cookieStorage:r},u=function(r,a){var c=e(s),u=null!=a?a:c,g=l[u.storage||"localStorage"],d=u.initialValue,f=o(!0),m=function(){if("undefined"==typeof window)return console.warn("Tried setting ".concat(u.storage," key “").concat(r,"” even though environment is not a client")),d;var e,o=g.getItem(r);return null===o&&void 0!==d?(g.setItem(r,d),null===(e=window)||void 0===e||e.dispatchEvent(new Event("local-storage-".concat(r))),d):o},v=t(m),w=i(v,2),p=w[0],S=w[1];return n((function(){return function(){f.current=!1}}),[]),n((function(){var e,o=function(){return f.current&&S(m())};return null===(e=window)||void 0===e||e.addEventListener("local-storage-".concat(r),o),function(){return window.removeEventListener("local-storage-".concat(r),o)}}),[]),[p,function(e){"undefined"==typeof window&&console.warn("Tried setting ".concat(u.storage," key “").concat(r,"” even though environment is not a client"));try{var o=e instanceof Function?e(p):e;g.setItem(r,o),f.current&&S(o),window.dispatchEvent(new Event("local-storage-".concat(r)))}catch(e){console.warn("Error setting localStorage key “".concat(r,"”:"),e)}}]};export{u as useStorage};
