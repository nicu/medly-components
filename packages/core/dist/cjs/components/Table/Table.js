"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("@babel/runtime/helpers/objectWithoutProperties")),o=require("react/jsx-runtime"),i=require("react"),r=(e(i),e(require("@babel/runtime/helpers/slicedToArray"))),n=require("@medly-components/utils"),s=e(require("@babel/runtime/helpers/defineProperty")),l=require("./context/TableComponentsCommonProps.context.js"),a=require("./context/TableState.context.js"),d=require("./ActionBar/ActionBar.js"),c=require("./constants.js"),u=require("./helpers.js"),f=require("./useRowSelector.js"),S=require("./Table.styled.js"),w=require("./Body/Body.js"),b=require("./ColumnConfiguration/ColumnConfiguration.js"),m=require("./Foot/Foot.js"),g=require("./Head/Head.js"),p=require("./maxColumnSizeReducer.js"),y=require("./useGroupedRowSelector.js"),j=require("./useScrollState.js");function h(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function R(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?h(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var C=i.memo(i.forwardRef((function(e,s){var b=e.data,h=(e.onSort,e.onRowClick),C=e.rowIdentifier,v=e.rowSelectionDisableKey,x=e.isRowSelectable,P=e.isRowExpandable,O=e.onRowSelection,I=e.isLoading,q=e.selectedRowIds,T=void 0===q?[]:q,B=e.showRowWithCardStyle,A=e.withPagination,D=e.onScrolledToBottom,E=e.withInfiniteScroll,z=e.onPageChange,k=e.maxHeight,F=e.keyBindings,K=t(e,["data","onSort","onRowClick","rowIdentifier","rowSelectionDisableKey","isRowSelectable","isRowExpandable","onRowSelection","isLoading","selectedRowIds","showRowWithCardStyle","withPagination","onScrolledToBottom","withInfiniteScroll","onPageChange","maxHeight","keyBindings"]),H=!!K.groupBy,G=B?"L":K.size,L=i.useRef(null),M=i.useState({sortField:e.defaultSortField,sortOrder:e.defaultSortOrder,activePage:e.defaultActivePage}),U=r(M,2),W=U[0],_=U[1],N=j.useScrollState(),Z=r(N,2),J=Z[0],Q=Z[1],V=i.useState([]),X=r(V,2),Y=X[0],$=X[1],ee=i.useState(!0),te=r(ee,2),oe=te[0],ie=te[1],re=n.useCombinedRefs(s,i.useRef(null)),ne=i.useReducer(p.maxColumnSizeReducer,{}),se=r(ne,2),le=se[0],ae=se[1],de=i.useState(u.getUpdatedColumns({columnConfigs:e.columns,isRowSelectable:x,isRowExpandable:P,size:G,isGroupedTable:H,maxColumnSizes:le})),ce=r(de,2),ue=ce[0],fe=ce[1],Se=i.useCallback((function(e,t){return ae({field:e,value:t,type:"ADD_SIZE"})}),[ae]),we=i.useMemo((function(){return!!h}),[h]),be=f({data:b,rowSelectionDisableKey:v,setSelectedIds:H?$:O,selectedIds:H?Y:T,rowIdentifier:K.groupBy||C}),me=be.isAnyRowSelected,ge=be.areAllRowsSelected,pe=be.toggleId,ye=be.setUniqueIds,je=y({setSelectedIds:O,selectedIds:T});return i.useEffect((function(){H&&ye([])}),[b]),i.useEffect((function(){fe(u.getUpdatedColumns({columnConfigs:e.columns,isRowSelectable:x,isRowExpandable:P,size:G,isGroupedTable:H,maxColumnSizes:le}))}),[e.columns,x,P,G,H]),i.useEffect((function(){ie(!!H||b.every((function(e){return e[v]})))}),[b,H,v]),n.useUpdateEffect((function(){H&&O&&O(je.selectedIds)}),[je.selectedIds]),i.useEffect((function(){J.isScrolledToBottom&&D&&D()}),[J.isScrolledToBottom]),i.useEffect((function(){E&&J.scrolledPercentage>70&&_((function(e){var t,o=R(R({},e),{},{activePage:(null!==(t=e.activePage)&&void 0!==t?t:0)+1});return z&&z(o),o}))}),[E,J.scrolledPercentage]),o.jsx(a.TableStateContext.Provider,Object.assign({value:[W,_]},{children:o.jsxs(l.TableComponentsCommonPropsContext.Provider,Object.assign({value:R(R({},e),{},{columns:ue,size:G,rowIdentifier:e.rowIdentifier,data:I?c.loadingBodyData:b,isGroupedTable:H,tableRef:re,hiddenDivRef:L,addColumnMaxSize:Se,keyBindings:R(R({},c.defaultKeyBindings),F)})},{children:[o.jsx(S.HiddenDiv,{ref:L},void 0),K.actions&&K.actions.length>0&&T.length>0&&o.jsx(d.ActionBar,{},void 0),o.jsxs(S.TableStyled,Object.assign({},K,{tabIndex:-1,ref:re,onScroll:Q,isRowClickable:we,showRowWithCardStyle:B,maxHeight:k},{children:[o.jsx(g,Object.assign({},{setColumns:fe,maxColumnSizes:le,areAllRowsSelected:ge,onSelectAllClick:pe,isSelectAllDisable:oe,showShadowAtBottom:!J.isScrolledToTop,showShadowAfterFrozenElement:!J.isScrolledToLeft,isAnyRowSelected:!ge&&(H?je.selectedIds.length>0:me)}),void 0),o.jsx(w,Object.assign({},{setUniqueIds:ye,setSelectAllDisableState:ie,selectedRowIds:H?Y:T,onRowSelection:pe,onGroupedRowSelection:je.toggleIds,showShadowAfterFrozenElement:!J.isScrolledToLeft}),void 0),A&&!E&&o.jsx(m.Foot,{tableSize:G},void 0)]}),void 0)]}),void 0)}),void 0)})));C.defaultProps={size:"M",selectedRowIds:[],rowIdentifier:"id",defaultSortOrder:"desc",defaultActivePage:1,rowClickDisableKey:"",rowSelectionDisableKey:"",actions:[],withPagination:!1,totalItems:0,itemsPerPage:20,withMinimap:!1,isRowSelectable:!1,isRowExpandable:!1,withRowSeparators:!0,keyBindings:c.defaultKeyBindings},C.displayName="Table";var v=Object.assign(C,{Style:S.TableStyled,ColumnConfiguration:b});exports.Component=C,exports.Table=v;
