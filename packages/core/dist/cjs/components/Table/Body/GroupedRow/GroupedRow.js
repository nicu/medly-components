"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react/jsx-runtime"),n=require("react"),r=(e(n),e(require("@babel/runtime/helpers/slicedToArray"))),o=require("@medly-components/utils"),i=e(require("@babel/runtime/helpers/defineProperty")),s=require("../../context/TableComponentsCommonProps.context.js"),a=require("../../constants.js"),u=e(require("@babel/runtime/helpers/asyncToGenerator")),c=e(require("@babel/runtime/regenerator")),l=require("../../useRowSelector.js"),d=require("./ContentRow/ContentRow.js"),f=require("./TitleRow/TitleRow.js");function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=n.memo((function(e){var i=n.useContext(s.TableComponentsCommonPropsContext),p=i.columns,b=i.groupBy,m=i.rowIdentifier,y=i.getGroupedData,S=i.rowSelectionDisableKey,j=i.addColumnMaxSize,R=i.defaultExpandedRowIdentifier,g=i.isLoading,v=e.id,x=e.setUniqueIds,O=e.titleRowData,h=e.selectedTitleRowIds,C=e.onTitleRowSelection,q=e.showShadowAfterFrozenElement,P=e.onGroupedRowSelection,D=e.setSelectAllDisableState,E=n.useState(O[m]===R),I=r(E,2),T=I[0],A=I[1],k=n.useState(!0),z=r(k,2),G=z[0],M=z[1],F=n.useState([]),B=r(F,2),U=B[0],K=B[1],L=n.useState(a.loadingBodyData),_=r(L,2),N=_[0],H=_[1],J=n.useMemo((function(){return!G&&h.includes(v)}),[v,G,h]),Q=n.useMemo((function(){var e=N.every((function(e){return S&&e[S]}));return!e&&D(!1),e}),[N,S]),V=l({data:N,rowSelectionDisableKey:S,rowIdentifier:m,selectedIds:U,setSelectedIds:K}),W=V.uniqueIds,X=V.isAnyRowSelected,Y=V.areAllRowsSelected,Z=V.toggleId,$=n.useCallback((function(){return A((function(e){return!e}))}),[]),ee=n.useCallback((function(){Z(-1),U.length>0?P(U):P(W)}),[Z]);return n.useEffect((function(){var e=function(){var e=u(c.mark((function e(){var t;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!b||!y){e.next=8;break}return M(!0),e.next=4,y(O[b]);case 4:t=e.sent,M(!1),H(t),x((function(e){return Array.from(new Set(e.concat(O[b])))}));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();T&&N===a.loadingBodyData&&e()}),[T]),o.useUpdateEffect((function(){J!==Y&&C(v)}),[Y]),o.useUpdateEffect((function(){J!==Y&&(J?(K(W),P(W.filter((function(e){return!U.includes(e)})))):U.length>0&&(K([]),P(U)))}),[J]),t.jsxs(t.Fragment,{children:[t.jsx(f.TitleRow,{id:"".concat(v,"-title-row"),data:O,isRowSelected:!Q&&J,isRowIndeterminate:X,isRowExpanded:!g&&T,onRowSelection:ee,onClick:$,isRowSelectionDisabled:G||Q,showShadowAfterFrozenElement:q},void 0),t.jsx(s.TableComponentsCommonPropsContext.Provider,Object.assign({value:w(w({},i),{},{columns:p.slice(1),isLoading:G})},{children:t.jsx(d.ContentRow,Object.assign({},{addColumnMaxSize:j,showShadowAfterFrozenElement:q,data:N,id:"".concat(v,"-content-row"),selectedRowIds:U,onRowSelection:function(e){P([e]),Z(e)},isRowExpanded:!g&&T}),void 0)}),void 0)]},void 0)}));b.displayName="GroupedRow",exports.GroupedRow=b;
