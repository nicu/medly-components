"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("@babel/runtime/helpers/objectWithoutProperties")),r=require("react/jsx-runtime"),n=require("react"),i=(e(n),e(require("@babel/runtime/helpers/slicedToArray"))),u=require("@medly-components/utils"),o=e(require("@babel/runtime/helpers/defineProperty")),l=e(require("@babel/runtime/helpers/toConsumableArray")),a=require("../TextField/TextField.js"),s=require("./helpers.js"),c=require("./InputSuffix/InputSuffix.js"),f=require("./MultiSelect.styled.js"),d=require("./Options/Options.js"),p=require("./useKeyboardNavigation.js");function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=n.memo(n.forwardRef((function(e,o){var b=e.id,h=e.size,C=e.label,m=e.disabled,O=e.showDecorators,g=e.values,y=e.onChange,j=e.options,x=e.variant,S=e.fullWidth,k=e.minWidth,T=e.errorText,w=e.helperText,P=e.required,q=e.isSearchable,E=e.validator,D=e.onInputChange,W=e.showTooltipForHelperAndErrorText,I=e.prefix,M=e.isCreatable,z=void 0!==M&&M,A=t(e,["id","size","label","disabled","showDecorators","values","onChange","options","variant","fullWidth","minWidth","errorText","helperText","required","isSearchable","validator","onInputChange","showTooltipForHelperAndErrorText","prefix","isCreatable"]),F=n.useMemo((function(){return b||(null==C?void 0:C.toLocaleLowerCase().replace(" ",""))||"medly-multiSelect"}),[b,C]),R=n.useRef(null),V=n.useRef(null),K=u.useCombinedRefs(o,n.useRef(null)),N=n.useState(j),H=i(N,2),B=H[0],L=H[1],_=n.useState(""),U=i(_,2),G=U[0],J=U[1],Q=n.useState(!1),X=i(Q,2),Y=X[0],Z=X[1],$=n.useState(s.getDefaultSelectedOptions(j,g)),ee=i($,2),te=ee[0],re=ee[1],ne=n.useState(s.getInputValue(te)),ie=i(ne,2),ue=ie[0],oe=ie[1],le=n.useState(g.length>0?"".concat(g.length," options selected"):e.placeholder),ae=i(le,2),se=ae[0],ce=ae[1],fe=n.useState(-1),de=i(fe,2),pe=de[0],be=de[1],ve=n.useState(!0),he=i(ve,2),Ce=he[0],me=he[1],Oe=u.useKeyPress(" ",!1,R),ge=n.useMemo((function(){return!!T||!!G}),[G,T]),ye=n.useMemo((function(){return z&&ue&&ue.length&&!B.some((function(e){return e.value.includes(ue)}))&&!te.some((function(e){return e.value===ue}))}),[ue,z,B,te]),je=n.useCallback((function(){return L(j)}),[j]),xe=n.useCallback((function(){Z(!1),D&&D(""),K.current&&K.current.blur()}),[Y,D]),Se=n.useCallback((function(){Z(!0),oe(""),K.current&&K.current.focus()}),[Y]),ke=n.useCallback((function(){return!m&&(Y?xe():Se())}),[m,Y]),Te=n.useCallback((function(e){var t=e.target.value;if(!Oe){oe(t);var r=s.filterOptions(B,t);r.length&&t?L(r):je(),D&&D(t),!Y&&Z(!0)}}),[Y,B,je,D,Oe]),we=n.useCallback((function(e){J(E&&E(e)||""),y&&y(e)}),[B,y]),Pe=n.useCallback((function(){me(!0),Y&&je(),xe()}),[Y]),qe=n.useCallback((function(){var e=te.filter((function(e){return e.disabled})).map((function(e){return e.value}));y&&y(e)}),[te]),Ee=n.useCallback((function(){var e=te.map((function(e){return e.value}));we([].concat(l(e),[ue])),re&&re((function(e){return[].concat(l(e),[{value:ue,label:ue,creatable:!0}])})),Se()}),[Se,te,we,ue,re]),De=n.useCallback((function(){var e;return Y&&(null===(e=K.current)||void 0===e?void 0:e.focus())}),[Y]),We=n.useCallback((function(e){z&&"Enter"===e.key&&(e.preventDefault(),ye&&Ee())}),[z,Ee,ye]),Ie=n.useCallback((function(){return""}),[]),Me=n.useCallback((function(){var e=E&&E(te)||P&&0===te.length&&"Please select at least one option."||"";J(e)}),[te,E]),ze=n.useCallback((function(e){var t=e.currentTarget;setTimeout((function(){return!t.contains(document.activeElement)&&Me()}),0)}),[Me]);n.useEffect((function(){var e,t;re(s.getDefaultSelectedOptions([].concat(l(j),l(te.filter((function(e){return!0===e.creatable})))),g)),L((null===(e=K.current)||void 0===e?void 0:e.value)?s.filterOptions(j,null===(t=K.current)||void 0===t?void 0:t.value):j)}),[j,g]),n.useEffect((function(){Y?(K.current&&K.current.focus(),ce(te.length>0?"".concat(te.length," options selected"):e.placeholder)):(oe(s.getInputValue(te)),L(j),setTimeout((function(){return xe()}),0))}),[te,Y]),u.useUpdateEffect((function(){te.length>0&&Me()}),[te]),u.useOuterClickNotifier((function(){Pe()}),R),p.useKeyboardNavigation({options:B,isParentCursorEnabled:Ce,setCursor:be,handleOuterClick:Pe,ref:R});return r.jsxs(f.Wrapper,Object.assign({id:"".concat(F,"-wrapper"),ref:R,isSearchable:q,onClick:ke,isErrorPresent:ge,onBlur:ze,areOptionsVisible:Y,variant:x},v(v({},A),{},{disabled:m,minWidth:k,fullWidth:S}),{children:[r.jsx(a.TextField,{fullWidth:!0,required:P,id:"".concat(F),size:h,autoComplete:"off",variant:x,disabled:m,showDecorators:O,value:ue,ref:K,placeholder:se,suffix:function(){return r.jsx(c.InputSuffix,{id:"".concat(F,"-count"),size:h,disabled:m,variant:x,hasError:ge,onClear:qe,isActive:Y,optionsCount:te.length,hideClearIcon:te.every((function(e){return e.disabled}))},void 0)},label:C,minWidth:k,onInvalid:Me,onChange:Te,onBlur:De,readOnly:!q&&!P,helperText:w,errorText:T||G,validator:Ie,showTooltipForHelperAndErrorText:W,prefix:I,onKeyDown:We},void 0),!m&&Y&&r.jsx(d,{id:"".concat(F),inputValue:ue,size:h,ref:V,values:te,setValues:re,options:B,onOptionClick:we,cursor:pe,setIsParentCursorEnabled:me,showCreatableOption:!!ye,handleCreatableOptionClick:Ee},void 0)]}),void 0)})));h.displayName="MultiSelect",h.defaultProps={size:"M",values:[],minWidth:"20rem",variant:"filled",isSearchable:!0,placeholder:"Please Select . . .",showDecorators:!0,isCreatable:!1};var C=Object.assign(h,{Style:f.Wrapper});exports.MultiSelect=C;
