import e from"@babel/runtime/helpers/objectWithoutProperties";import{jsx as o,jsxs as t}from"react/jsx-runtime";import{memo as i,forwardRef as r,useRef as n,useState as l,useReducer as s,useCallback as a,useMemo as c,useEffect as d}from"react";import m from"@babel/runtime/helpers/slicedToArray";import{useCombinedRefs as u,useUpdateEffect as f}from"@medly-components/utils";import w from"@babel/runtime/helpers/defineProperty";import{TableComponentsCommonPropsContext as p}from"./context/TableComponentsCommonProps.context.js";import{TableStateContext as S}from"./context/TableState.context.js";import{ActionBar as b}from"./ActionBar/ActionBar.js";import{defaultKeyBindings as g,loadingBodyData as h}from"./constants.js";import{getUpdatedColumns as y}from"./helpers.js";import R from"./useRowSelector.js";import{TableStyled as j,HiddenDiv as v}from"./Table.styled.js";import P from"./Body/Body.js";import C from"./ColumnConfiguration/ColumnConfiguration.js";import{Foot as I}from"./Foot/Foot.js";import O from"./Head/Head.js";import{maxColumnSizeReducer as x}from"./maxColumnSizeReducer.js";import A from"./useGroupedRowSelector.js";import{useScrollState as B}from"./useScrollState.js";function T(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);o&&(i=i.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,i)}return t}function z(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?T(Object(t),!0).forEach((function(o){w(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):T(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var D=i(r((function(i,r){var w=i.data,C=(i.onSort,i.onRowClick),T=i.rowIdentifier,D=i.rowSelectionDisableKey,k=i.isRowSelectable,E=i.isRowExpandable,F=i.onRowSelection,G=i.isLoading,H=i.selectedRowIds,K=void 0===H?[]:H,L=i.showRowWithCardStyle,W=i.withPagination,M=i.onScrolledToBottom,q=i.withInfiniteScroll,U=i.onPageChange,N=i.maxHeight,Z=i.keyBindings,_=e(i,["data","onSort","onRowClick","rowIdentifier","rowSelectionDisableKey","isRowSelectable","isRowExpandable","onRowSelection","isLoading","selectedRowIds","showRowWithCardStyle","withPagination","onScrolledToBottom","withInfiniteScroll","onPageChange","maxHeight","keyBindings"]),J=!!_.groupBy,Q=L?"L":_.size,V=n(null),X=l({sortField:i.defaultSortField,sortOrder:i.defaultSortOrder,activePage:i.defaultActivePage}),Y=m(X,2),$=Y[0],ee=Y[1],oe=B(),te=m(oe,2),ie=te[0],re=te[1],ne=l([]),le=m(ne,2),se=le[0],ae=le[1],ce=l(!0),de=m(ce,2),me=de[0],ue=de[1],fe=u(r,n(null)),we=s(x,{}),pe=m(we,2),Se=pe[0],be=pe[1],ge=l(y({columnConfigs:i.columns,isRowSelectable:k,isRowExpandable:E,size:Q,isGroupedTable:J,maxColumnSizes:Se})),he=m(ge,2),ye=he[0],Re=he[1],je=a((function(e,o){return be({field:e,value:o,type:"ADD_SIZE"})}),[be]),ve=c((function(){return!!C}),[C]),Pe=R({data:w,rowSelectionDisableKey:D,setSelectedIds:J?ae:F,selectedIds:J?se:K,rowIdentifier:_.groupBy||T}),Ce=Pe.isAnyRowSelected,Ie=Pe.areAllRowsSelected,Oe=Pe.toggleId,xe=Pe.setUniqueIds,Ae=A({setSelectedIds:F,selectedIds:K});return d((function(){J&&xe([])}),[w]),d((function(){Re(y({columnConfigs:i.columns,isRowSelectable:k,isRowExpandable:E,size:Q,isGroupedTable:J,maxColumnSizes:Se}))}),[i.columns,k,E,Q,J]),d((function(){ue(!!J||w.every((function(e){return e[D]})))}),[w,J,D]),f((function(){J&&F&&F(Ae.selectedIds)}),[Ae.selectedIds]),d((function(){ie.isScrolledToBottom&&M&&M()}),[ie.isScrolledToBottom]),d((function(){q&&ie.scrolledPercentage>70&&ee((function(e){var o,t=z(z({},e),{},{activePage:(null!==(o=e.activePage)&&void 0!==o?o:0)+1});return U&&U(t),t}))}),[q,ie.scrolledPercentage]),o(S.Provider,Object.assign({value:[$,ee]},{children:t(p.Provider,Object.assign({value:z(z({},i),{},{columns:ye,size:Q,rowIdentifier:i.rowIdentifier,data:G?h:w,isGroupedTable:J,tableRef:fe,hiddenDivRef:V,addColumnMaxSize:je,keyBindings:z(z({},g),Z)})},{children:[o(v,{ref:V},void 0),_.actions&&_.actions.length>0&&K.length>0&&o(b,{},void 0),t(j,Object.assign({},_,{tabIndex:-1,ref:fe,onScroll:re,isRowClickable:ve,showRowWithCardStyle:L,maxHeight:N},{children:[o(O,Object.assign({},{setColumns:Re,maxColumnSizes:Se,areAllRowsSelected:Ie,onSelectAllClick:Oe,isSelectAllDisable:me,showShadowAtBottom:!ie.isScrolledToTop,showShadowAfterFrozenElement:!ie.isScrolledToLeft,isAnyRowSelected:!Ie&&(J?Ae.selectedIds.length>0:Ce)}),void 0),o(P,Object.assign({},{setUniqueIds:xe,setSelectAllDisableState:ue,selectedRowIds:J?se:K,onRowSelection:Oe,onGroupedRowSelection:Ae.toggleIds,showShadowAfterFrozenElement:!ie.isScrolledToLeft}),void 0),W&&!q&&o(I,{tableSize:Q},void 0)]}),void 0)]}),void 0)}),void 0)})));D.defaultProps={size:"M",selectedRowIds:[],rowIdentifier:"id",defaultSortOrder:"desc",defaultActivePage:1,rowClickDisableKey:"",rowSelectionDisableKey:"",actions:[],withPagination:!1,totalItems:0,itemsPerPage:20,withMinimap:!1,isRowSelectable:!1,isRowExpandable:!1,withRowSeparators:!0,keyBindings:g},D.displayName="Table";var k=Object.assign(D,{Style:j,ColumnConfiguration:C});export{D as Component,k as Table};
