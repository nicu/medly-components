import e from"@babel/runtime/helpers/objectWithoutProperties";import{jsx as n,jsxs as t}from"react/jsx-runtime";import{memo as r,useRef as i,useState as o,useMemo as u,useCallback as c,useEffect as l}from"react";import s from"@babel/runtime/helpers/slicedToArray";import{debounce as d}from"@medly-components/utils";import m from"@babel/runtime/helpers/toConsumableArray";import a from"resize-observer-polyfill";import{MinimapContainer as f,SliderContent as p,Minimap as v,SliderRange as h,SliderContentWrapper as w,SliderController as b}from"./Minimap.styled.js";var W=r((function(r){var W=r.minimapWidth,g=r.controllerWidth,E=r.sliderContentPadding,L=r.tableRef,y=r.minimapDimensionDeps,D=e(r,["minimapWidth","controllerWidth","sliderContentPadding","tableRef","minimapDimensionDeps"]),j=i(null),P=i(null),C=o(!1),M=s(C,2),O=M[0],x=M[1],z=o(0),A=s(z,2),R=A[0],B=A[1],N=o(0),S=s(N,2),T=S[0],X=S[1],k=o(!1),q=s(k,2),F=q[0],G=q[1],H=W-g-2*E,I=u((function(){return new Array(8).fill(null).map((function(e,t){return n(p,{controllerWidth:g},t)}))}),[g]),J=c((function(){var e=L.current?L.current.scrollWidth-L.current.clientWidth:0;B(e/H),X(H/e),G(L.current&&L.current.scrollWidth>L.current.offsetWidth)}),[H]),K=c((function(e){e&&e.stopPropagation(),!O&&j.current&&(j.current.style.left="".concat(L.current.scrollLeft*T,"px"))}),[T,O]),Q=c((function(e){if(e.stopPropagation(),P.current&&L.current&&j.current){var n=Math.round(e.clientX-P.current.getBoundingClientRect().left-g/2);n>H?n=H:n<0&&(n=0),j.current.style.left="".concat(n,"px"),L.current.scrollLeft=n*R}}),[g,R,H]),U=c((function(e){e.stopPropagation(),e.preventDefault(),x(!0),Q(e)}),[Q]),V=c((function(){x(!1),window.removeEventListener("mousemove",Q)}),[Q]),Y=u((function(){return new a(d((function(){J(),K()}),150))}),[J,K]);return l((function(){if(L.current)return Y.observe(L.current),function(){return Y.disconnect()}}),[Y,L.current]),l((function(){J(),K()}),m(y)),l((function(){return window.addEventListener("load",J),window.addEventListener("resize",J),function(){window.removeEventListener("load",J),window.removeEventListener("resize",J)}}),[J]),l((function(){var e=L.current;return e.addEventListener("scroll",K),function(){return e.removeEventListener("scroll",K)}}),[K]),l((function(){if(O)return window.addEventListener("mousemove",Q),function(){return window.removeEventListener("mousemove",Q)}}),[O,Q]),l((function(){return window.addEventListener("mouseup",V),document.documentElement.addEventListener("mouseleave",V),function(){window.removeEventListener("mouseup",V),document.documentElement.removeEventListener("mouseleave",V)}}),[V]),F?n(f,Object.assign({},D,{children:n(v,Object.assign({id:"minimap",sliderWidth:W},{children:t(h,Object.assign({ref:P,onMouseDown:U,rangeWidth:W-2*E,padding:E},{children:[n(w,Object.assign({contentWidth:W-2*E},{children:I}),void 0),n(b,{id:"sliderController",onMouseDown:U,ref:j,controllerWidth:g},void 0)]}),void 0)}),void 0)}),void 0):null}));W.displayName="Minimap",W.defaultProps={minimapWidth:126,controllerWidth:40,sliderContentPadding:8,minimapDimensionDeps:[]};var g=Object.assign(W,{Style:f});export{g as Minimap};
