import e from"@babel/runtime/helpers/objectWithoutProperties";import{jsx as o,jsxs as t}from"react/jsx-runtime";import{memo as r,forwardRef as i,useRef as n,useState as l,useReducer as s,useCallback as c,useEffect as d,useLayoutEffect as a}from"react";import p from"@babel/runtime/helpers/slicedToArray";import{useCombinedRefs as m,useKeyPress as u,useWindowSize as f}from"@medly-components/utils";import b from"@babel/runtime/helpers/defineProperty";import{reducer as h}from"./scrollStateReducer/scrollStateReducer.js";import{useScrollState as O}from"./useScrollState.js";import{ModalContext as j}from"./Modal.context.js";import{Actions as v}from"./Actions/Actions.js";import{CloseIcon as y}from"./CloseIcon/CloseIcon.styled.js";import{Content as g}from"./Content/Content.js";import{Header as P}from"./Header/Header.js";import{ModalBackgroundStyled as C,InnerContainerStyled as S}from"./Modal.styled.js";import{Popup as w}from"./Popup/Popup.js";function H(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o&&(r=r.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,r)}return t}function k(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?H(Object(t),!0).forEach((function(o){b(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):H(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var A=r(i((function(r,i){var b=r.open,v=r.onCloseModal,g=r.overflowVisible,P=r.children,H=r.minWidth,A=r.shouldCloseOnOutsideClick,M=r.minHeight,E=e(r,["open","onCloseModal","overflowVisible","children","minWidth","shouldCloseOnOutsideClick","minHeight"]),V=E.id||"medly-modal",D=m(i,n(null)),T=u("Escape",!1,D),W=n(null),x=l(0),I=p(x,2),R=I[0],z=I[1],B=l(),N=p(B,2),q=N[0],F=N[1],G=s(h,{scrolledToTop:!0,scrolledToBottom:!1,scrollPosition:0}),J=p(G,2),K=J[0],L=J[1],Q=l(b),U=p(Q,2),X=U[0],Y=U[1],Z=f().width<768,$=c((function(){A&&v&&v()}),[A,v]),_=c((function(){b||(Y(!1),document.body.style.overflow="unset")}),[b]);d((function(){return b&&(Y(!0),document.body.style.overflow="hidden"),function(){document.body.style.overflow="unset"}}),[b]),d((function(){b&&T&&v&&v()}),[b,T]),a((function(){b&&F(document.activeElement)}),[b]),d((function(){!X&&(null==q||q.focus())}),[X]);var ee=n(null),oe=O({ref:ee,scrollState:K,dispatch:L});return X?o(C,Object.assign({},k(k({},E),{},{id:V,open:b,isSmallScreen:Z}),{onClick:$},{children:t(w,Object.assign({ref:D,id:"".concat(V,"-popup"),onAnimationEnd:_},{minWidth:H,minHeight:M,open:b,overflowVisible:g},{children:[o(y,{id:"".concat(V,"-close-button"),title:"".concat(V,"-close-icon"),size:"M",variant:"solid",onClick:v},void 0),o(S,Object.assign({id:"".concat(V,"-inner-container"),ref:W,headerHeight:R,overflowVisible:g,onScroll:oe},{children:o(j.Provider,Object.assign({value:{headerHeight:R,setHeaderHeight:z,scrollState:K,dispatch:L,id:V,isSmallScreen:Z,overflowVisible:g}},{children:P}),void 0)}),void 0)]}),void 0)}),void 0):null})));A.defaultProps={open:!1,shouldCloseOnOutsideClick:!1},A.displayName="Modal";var M=Object.assign(A,{Style:C,Header:P,Popup:w,Content:g,Actions:v});export{M as Modal};
