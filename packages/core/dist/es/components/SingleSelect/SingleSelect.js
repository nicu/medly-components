import e from"@babel/runtime/helpers/objectWithoutProperties";import{jsxs as i,jsx as t}from"react/jsx-runtime";import{memo as r,forwardRef as o,useMemo as n,useRef as a,useState as l,useCallback as s}from"react";import u from"@babel/runtime/helpers/slicedToArray";import{ChevronDownIcon as d}from"@medly-components/icons";import{useCombinedRefs as c,useUpdateEffect as f,useOuterClickNotifier as p}from"@medly-components/utils";import{TextField as m}from"../TextField/TextField.js";import{FlatVariant as v}from"./FlatVariant/FlatVariant.js";import{getDefaultSelectedOption as h,getUpdatedOptions as b,filterOptions as O}from"./helpers.js";import x from"./Options/Options.js";import{Wrapper as W}from"./SingleSelect.styled.js";import{useKeyboardNavigation as g}from"./useKeyboardNavigation.js";var y=r(o((function(r,o){var y=r.id,j=r.value,S=r.onChange,F=r.options,N=r.variant,T=r.minWidth,C=r.maxWidth,w=r.includesNestedOptions,P=r.fullWidth,V=r.disabled,D=r.showDecorators,q=r.onFocus,k=r.onBlur,z=r.className,A=r.validator,B=r.isSearchable,K=r.suffix,E=e(r,["id","value","onChange","options","variant","minWidth","maxWidth","includesNestedOptions","fullWidth","disabled","showDecorators","onFocus","onBlur","className","validator","isSearchable","suffix"]),L=n((function(){var e;return y||(null===(e=E.label)||void 0===e?void 0:e.toLocaleLowerCase())||"medly-singleSelect"}),[y,E.label]),I=h(F,j),M=a(null),R=a(null),G=c(o,a(null)),H=a(!1),J=l(!1),Q=u(J,2),U=Q[0],X=Q[1],Y=l(I.label),Z=u(Y,2),$=Z[0],_=Z[1],ee=l(I),ie=u(ee,2),te=ie[0],re=ie[1],oe=l(""),ne=u(oe,2),ae=ne[0],le=ne[1],se=l(b(F,I)),ue=u(se,2),de=ue[0],ce=ue[1],fe=s((function(){return ce(b(F,te))}),[F,te]),pe=s((function(){var e;return le(A&&A(null===(e=G.current)||void 0===e?void 0:e.value)||E.required&&!j&&"Please select one option."||"")}),[E.required,A,j]),me=s((function(){var e;X(!0),B&&_(""),null===(e=G.current)||void 0===e||e.focus()}),[B,$]),ve=s((function(){X(!1),G.current&&G.current.blur()}),[]),he=s((function(){return!V&&(U?ve():me())}),[V,U]),be=s((function(e){var i=e.target.value,t=O(b(F,te),i);_(i),t.length&&i?ce(t):fe(),1===t.length&&t[0].label===i?!U&&S&&S(t[0].value):U||X(!0)}),[U,F,te,fe]),Oe=s((function(e){var i;e.disabled||Array.isArray(e.value)?null===(i=G.current)||void 0===i||i.focus():(re(e),ce(b(de,e)),_(e.label),ve(),S&&S(e.value),le(""))}),[G.current,de,S]),xe=s((function(){U&&(ve(),pe(),fe(),_(I.label))}),[U,te,fe,pe]),We=s((function(e){H.current=!0,q&&q(e)}),[q]),ge=s((function(){return""}),[]),ye=s((function(e){return!B&&e.preventDefault()}),[B]);f((function(){var e=h(F,j);_(e.label),re(e),ce(b(F,e)),j&&j!==e.value&&S&&S(e.value)}),[F,j]),g({isFocused:H,selectedOption:te,options:de,areOptionsVisible:U,setOptions:ce,handleOptionClick:Oe,showOptions:me,optionsRef:R,hideOptions:ve}),p((function(){xe()}),M);var je={id:"".concat(L),ref:G,value:$,label:E.label,helperText:E.helperText,errorText:E.errorText||ae,onFocus:We,onBlur:k,onKeyPress:ye,disabled:V,showDecorators:D,areOptionsVisible:U,onInvalid:pe,validator:ge};return i(W,Object.assign({id:"".concat(L,"-wrapper")},{disabled:V,maxWidth:C,fullWidth:P},{minWidth:"flat"===N?"fit-content":T,variant:N,ref:M,className:z,isSearchable:B,isErrorPresent:!!r.errorText,onClick:he,areOptionsVisible:U},{children:["flat"==N?t(v,Object.assign({},je),void 0):t(m,Object.assign({fullWidth:!0,variant:N,autoComplete:"off",onChange:be,suffix:K||d},E,je,{minWidth:T,maxWidth:C,readOnly:!E.required&&!B}),void 0),!V&&U&&t(x,{size:"flat"===N?"S":E.size,ref:R,variant:N,id:"".concat(L,"-options"),options:de,hasError:!!r.errorText,onOptionClick:Oe,maxWidth:C,includesNestedOptions:w},void 0)]}),void 0)})));y.displayName="SingleSelect",y.defaultProps={value:"",size:"M",label:"",minWidth:"20rem",variant:"filled",fullWidth:!1,required:!1,isSearchable:!1,includesNestedOptions:!1,placeholder:"Please Select . . .",showDecorators:!0};var j=Object.assign(y,{Style:W});export{j as SingleSelect};
