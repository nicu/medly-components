import e from"@babel/runtime/helpers/objectWithoutProperties";import{jsxs as r,jsx as t}from"react/jsx-runtime";import{memo as n,forwardRef as o,useMemo as i,useRef as l,useState as a,useCallback as u,useEffect as c}from"react";import s from"@babel/runtime/helpers/slicedToArray";import{useCombinedRefs as f,useKeyPress as p,useUpdateEffect as d,useOuterClickNotifier as h}from"@medly-components/utils";import v from"@babel/runtime/helpers/defineProperty";import m from"@babel/runtime/helpers/toConsumableArray";import{TextField as b}from"../TextField/TextField.js";import{getDefaultSelectedOptions as g,getInputValue as O,filterOptions as y}from"./helpers.js";import{InputSuffix as C}from"./InputSuffix/InputSuffix.js";import{Wrapper as j}from"./MultiSelect.styled.js";import x from"./Options/Options.js";import{useKeyboardNavigation as T}from"./useKeyboardNavigation.js";function w(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function P(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?w(Object(t),!0).forEach((function(r){v(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var S=n(o((function(n,o){var v=n.id,w=n.size,S=n.label,E=n.disabled,D=n.showDecorators,W=n.values,I=n.onChange,k=n.options,z=n.variant,A=n.fullWidth,F=n.minWidth,q=n.errorText,H=n.helperText,K=n.required,M=n.isSearchable,N=n.validator,V=n.onInputChange,B=n.showTooltipForHelperAndErrorText,L=n.prefix,G=n.isCreatable,J=void 0!==G&&G,Q=e(n,["id","size","label","disabled","showDecorators","values","onChange","options","variant","fullWidth","minWidth","errorText","helperText","required","isSearchable","validator","onInputChange","showTooltipForHelperAndErrorText","prefix","isCreatable"]),R=i((function(){return v||(null==S?void 0:S.toLocaleLowerCase().replace(" ",""))||"medly-multiSelect"}),[v,S]),U=l(null),X=l(null),Y=f(o,l(null)),Z=a(k),$=s(Z,2),_=$[0],ee=$[1],re=a(""),te=s(re,2),ne=te[0],oe=te[1],ie=a(!1),le=s(ie,2),ae=le[0],ue=le[1],ce=a(g(k,W)),se=s(ce,2),fe=se[0],pe=se[1],de=a(O(fe)),he=s(de,2),ve=he[0],me=he[1],be=a(W.length>0?"".concat(W.length," options selected"):n.placeholder),ge=s(be,2),Oe=ge[0],ye=ge[1],Ce=a(-1),je=s(Ce,2),xe=je[0],Te=je[1],we=a(!0),Pe=s(we,2),Se=Pe[0],Ee=Pe[1],De=p(" ",!1,U),We=i((function(){return!!q||!!ne}),[ne,q]),Ie=i((function(){return J&&ve&&ve.length&&!_.some((function(e){return e.value.includes(ve)}))&&!fe.some((function(e){return e.value===ve}))}),[ve,J,_,fe]),ke=u((function(){return ee(k)}),[k]),ze=u((function(){ue(!1),V&&V(""),Y.current&&Y.current.blur()}),[ae,V]),Ae=u((function(){ue(!0),me(""),Y.current&&Y.current.focus()}),[ae]),Fe=u((function(){return!E&&(ae?ze():Ae())}),[E,ae]),qe=u((function(e){var r=e.target.value;if(!De){me(r);var t=y(_,r);t.length&&r?ee(t):ke(),V&&V(r),!ae&&ue(!0)}}),[ae,_,ke,V,De]),He=u((function(e){oe(N&&N(e)||""),I&&I(e)}),[_,I]),Ke=u((function(){Ee(!0),ae&&ke(),ze()}),[ae]),Me=u((function(){var e=fe.filter((function(e){return e.disabled})).map((function(e){return e.value}));I&&I(e)}),[fe]),Ne=u((function(){var e=fe.map((function(e){return e.value}));He([].concat(m(e),[ve])),pe&&pe((function(e){return[].concat(m(e),[{value:ve,label:ve,creatable:!0}])})),Ae()}),[Ae,fe,He,ve,pe]),Ve=u((function(){var e;return ae&&(null===(e=Y.current)||void 0===e?void 0:e.focus())}),[ae]),Be=u((function(e){J&&"Enter"===e.key&&(e.preventDefault(),Ie&&Ne())}),[J,Ne,Ie]),Le=u((function(){return""}),[]),Ge=u((function(){var e=N&&N(fe)||K&&0===fe.length&&"Please select at least one option."||"";oe(e)}),[fe,N]),Je=u((function(e){var r=e.currentTarget;setTimeout((function(){return!r.contains(document.activeElement)&&Ge()}),0)}),[Ge]);c((function(){var e,r;pe(g([].concat(m(k),m(fe.filter((function(e){return!0===e.creatable})))),W)),ee((null===(e=Y.current)||void 0===e?void 0:e.value)?y(k,null===(r=Y.current)||void 0===r?void 0:r.value):k)}),[k,W]),c((function(){ae?(Y.current&&Y.current.focus(),ye(fe.length>0?"".concat(fe.length," options selected"):n.placeholder)):(me(O(fe)),ee(k),setTimeout((function(){return ze()}),0))}),[fe,ae]),d((function(){fe.length>0&&Ge()}),[fe]),h((function(){Ke()}),U),T({options:_,isParentCursorEnabled:Se,setCursor:Te,handleOuterClick:Ke,ref:U});return r(j,Object.assign({id:"".concat(R,"-wrapper"),ref:U,isSearchable:M,onClick:Fe,isErrorPresent:We,onBlur:Je,areOptionsVisible:ae,variant:z},P(P({},Q),{},{disabled:E,minWidth:F,fullWidth:A}),{children:[t(b,{fullWidth:!0,required:K,id:"".concat(R),size:w,autoComplete:"off",variant:z,disabled:E,showDecorators:D,value:ve,ref:Y,placeholder:Oe,suffix:function(){return t(C,{id:"".concat(R,"-count"),size:w,disabled:E,variant:z,hasError:We,onClear:Me,isActive:ae,optionsCount:fe.length,hideClearIcon:fe.every((function(e){return e.disabled}))},void 0)},label:S,minWidth:F,onInvalid:Ge,onChange:qe,onBlur:Ve,readOnly:!M&&!K,helperText:H,errorText:q||ne,validator:Le,showTooltipForHelperAndErrorText:B,prefix:L,onKeyDown:Be},void 0),!E&&ae&&t(x,{id:"".concat(R),inputValue:ve,size:w,ref:X,values:fe,setValues:pe,options:_,onOptionClick:He,cursor:xe,setIsParentCursorEnabled:Ee,showCreatableOption:!!Ie,handleCreatableOptionClick:Ne},void 0)]}),void 0)})));S.displayName="MultiSelect",S.defaultProps={size:"M",values:[],minWidth:"20rem",variant:"filled",isSearchable:!0,placeholder:"Please Select . . .",showDecorators:!0,isCreatable:!1};var E=Object.assign(S,{Style:j});export{E as MultiSelect};
